<%- include('../layouts/header', { title: 'Mon Profil' }) %>

<style>
  .main-content {
    padding-top: 5px !important;
    margin-top: 0 !important;
  }
  
  .profile-container {
    padding-top: 5px !important;
    padding-bottom: 3rem;
    margin-top: 10vh !important;
  }
  
  .profile-header {
    background: linear-gradient(120deg, #6a11cb 0%, #2575fc 100%);
    border-radius: 16px;
    padding: 1.2rem;
    color: white;
    margin-bottom: 0;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    position: relative;
    overflow: hidden;
    z-index: 5;
    height: 130px;
  }
  
  .profile-header::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
    z-index: 1;
  }
  
  .profile-header h1 {
    font-size: 1.8rem;
    font-weight: 700;
    position: relative;
    z-index: 2;
    margin-bottom: 0.2rem;
  }
  
  .profile-header .profile-icon {
    font-size: 2.8rem;
    margin-bottom: 0.2rem;
    opacity: 0.9;
  }
  
  .profile-card {
    border: none;
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
    transition: transform 0.3s, box-shadow 0.3s;
    margin-bottom: 1.5rem;
    overflow: hidden;
    margin-top: -2.5rem;
    position: relative;
    z-index: 10;
  }
  
  .profile-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.12);
  }
  
  .profile-form label {
    font-weight: 700;
    color: #495057;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .profile-form .form-control, 
  .profile-form .form-select {
    border-radius: 10px;
    border: 1px solid #e2e8f0;
    padding: 0.85rem 1rem;
    transition: all 0.3s;
    font-size: 1rem;
    background-color: #f8fafc;
    box-shadow: 0 2px 5px rgba(0,0,0,0.02);
  }
  
  .profile-form .form-control:focus, 
  .profile-form .form-select:focus {
    border-color: #6a11cb;
    box-shadow: 0 0 0 0.25rem rgba(106, 17, 203, 0.15);
    background-color: #fff;
  }
  
  .input-icon-wrapper {
    position: relative;
  }
  
  .input-icon-wrapper .input-icon {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: #6a11cb;
    z-index: 10;
    opacity: 0.7;
    font-size: 1.1rem;
  }
  
  .input-icon-wrapper .form-control {
    padding-left: 45px;
  }
  
  .security-wrapper {
    background-color: rgba(106, 17, 203, 0.03);
  }
  
  .security-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(120deg, #6a11cb 0%, #2575fc 100%);
    color: white;
    font-size: 1.2rem;
  }
  
  .input-group-text {
    color: #6a11cb;
    opacity: 0.8;
  }
  
  .input-group-lg > .form-control,
  .input-group-lg > .input-group-text {
    padding: 0.7rem 1.2rem;
  }
  
  .btn-profile-save {
    background: linear-gradient(120deg, #6a11cb 0%, #2575fc 100%);
    border: none;
    border-radius: 10px;
    color: white;
    padding: 0.75rem 2rem;
    font-weight: 600;
    transition: all 0.3s;
    box-shadow: 0 4px 15px rgba(106, 17, 203, 0.3);
  }
  
  .btn-profile-save:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(106, 17, 203, 0.5);
  }
  
  .btn-profile-back {
    border-radius: 10px;
    font-weight: 600;
    transition: all 0.3s;
    border: 2px solid #6c757d;
  }
  
  .btn-profile-back:hover {
    transform: translateY(-3px);
    background-color: #6c757d;
    color: white;
  }
  
  .danger-zone {
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
    position: relative;
    overflow: hidden;
    border: none;
  }
  
  .danger-zone-header {
    background: linear-gradient(120deg, #ff4b2b 0%, #ff416c 100%);
    color: white;
    padding: 1.5rem;
    position: relative;
  }
  
  .danger-zone-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    opacity: 0.3;
  }
  
  .btn-danger-outline {
    background: transparent;
    color: #ff416c;
    border: 2px solid #ff416c;
    border-radius: 10px;
    padding: 0.75rem 1.5rem;
    font-weight: 600;
    transition: all 0.3s;
    position: relative;
    overflow: hidden;
    z-index: 1;
  }
  
  .btn-danger-outline:hover {
    color: white;
    transform: translateY(-3px);
    box-shadow: 0 8px 15px rgba(255, 65, 108, 0.3);
  }
  
  .btn-danger-outline::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 0%;
    height: 100%;
    background: linear-gradient(120deg, #ff416c 0%, #ff4b2b 100%);
    transition: all 0.3s;
    z-index: -1;
  }
  
  .btn-danger-outline:hover::before {
    width: 100%;
  }
  
  .danger-icon {
    font-size: 1.5rem;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .custom-modal .modal-content {
    border: none;
    border-radius: 16px;
    overflow: hidden;
  }
  
  .custom-modal .modal-header {
    border-bottom: none;
    padding: 1.5rem;
  }
  
  .custom-modal .modal-body {
    padding: 1.5rem;
  }
  
  .custom-modal .modal-footer {
    border-top: none;
    padding: 1.5rem;
  }
  
  .alert {
    border-radius: 10px;
    border: none;
    padding: 1rem 1.5rem;
  }
  
  .alert-success {
    background-color: rgba(25, 135, 84, 0.1);
    color: #198754;
  }
  
  .alert-danger {
    background-color: rgba(220, 53, 69, 0.1);
    color: #dc3545;
  }
  
  .profile-info-item {
    display: flex;
    align-items: center;
    margin-bottom: 1rem;
    padding: 1rem;
    background-color: #f8fafc;
    border-radius: 10px;
    transition: all 0.3s;
  }
  
  .profile-info-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
  }
  
  .profile-info-icon {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: linear-gradient(120deg, #6a11cb 0%, #2575fc 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    margin-right: 1rem;
  }
  
  .profile-info-content {
    flex: 1;
  }
  
  .profile-info-label {
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: #6c757d;
    margin-bottom: 0.2rem;
    font-weight: 600;
  }
  
  .profile-info-value {
    font-size: 1.1rem;
    font-weight: 600;
    color: #343a40;
    margin-bottom: 0;
  }
  
  .btn-edit-profile {
    background: linear-gradient(120deg, #6a11cb 0%, #2575fc 100%);
    border: none;
    border-radius: 50px;
    color: white;
    padding: 0.75rem 2.5rem;
    font-weight: 600;
    transition: all 0.3s;
    box-shadow: 0 4px 15px rgba(106, 17, 203, 0.3);
  }
  
  .btn-edit-profile:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(106, 17, 203, 0.5);
  }
  
  .modal-profile .modal-header {
    background: linear-gradient(120deg, #6a11cb 0%, #2575fc 100%);
    color: white;
    border: none;
  }
  
  .modal-profile .modal-content {
    border-radius: 16px;
    border: none;
    overflow: hidden;
  }
</style>

<div class="container profile-container main-content">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="profile-header text-center d-flex flex-column justify-content-center">
        <i class="fas fa-user-circle profile-icon"></i>
        <h1>Mon Profil</h1>
        <p class="mb-0">Gérez vos informations personnelles et préférences</p>
      </div>
      
      <div class="profile-card">
        <div class="card-body p-4 pt-5">
          <% if (locals.success && success.length > 0) { %>
            <div class="alert alert-success d-flex align-items-center mb-4">
              <i class="fas fa-check-circle me-2"></i>
              <%= success %>
            </div>
          <% } %>
          
          <% if (locals.error && error.length > 0) { %>
            <div class="alert alert-danger d-flex align-items-center mb-4">
              <i class="fas fa-exclamation-circle me-2"></i>
              <%= error %>
            </div>
          <% } %>
          
          <div class="profile-info mb-4">
            <div class="profile-info-item">
              <div class="profile-info-icon">
                <i class="fas fa-user"></i>
              </div>
              <div class="profile-info-content">
                <div class="profile-info-label">Nom</div>
                <div class="profile-info-value"><%= user.name %></div>
              </div>
            </div>

            <div class="profile-info-item">
              <div class="profile-info-icon">
                <i class="fas fa-envelope"></i>
              </div>
              <div class="profile-info-content">
                <div class="profile-info-label">Email</div>
                <div class="profile-info-value"><%= user.email %></div>
              </div>
            </div>

            <div class="profile-info-item">
              <div class="profile-info-icon">
                <i class="fas fa-money-bill-wave"></i>
              </div>
              <div class="profile-info-content">
                <div class="profile-info-label">Devise</div>
                <div class="profile-info-value">
                  <% if (user.currency === 'EUR') { %>Euro (€)<% } %>
                  <% if (user.currency === 'USD') { %>Dollar US ($)<% } %>
                  <% if (user.currency === 'GBP') { %>Livre Sterling (£)<% } %>
                  <% if (user.currency === 'MAD') { %>Dirham Marocain (MAD)<% } %>
                </div>
              </div>
            </div>
          </div>
          
          <div class="d-flex justify-content-center mt-4">
            <button type="button" class="btn btn-lg btn-edit-profile" data-bs-toggle="modal" data-bs-target="#editProfileModal">
              <i class="fas fa-user-edit me-2"></i>
              Modifier mon profil
            </button>
          </div>
          
          <div class="d-flex justify-content-end mt-4">
            <a href="/dashboard" class="btn btn-outline-secondary btn-lg btn-profile-back">
              <i class="fas fa-arrow-left me-2"></i>
              Retour au tableau de bord
            </a>
          </div>
        </div>
      </div>
      
      <div class="card danger-zone mt-4 border-0 shadow">
        <div class="danger-zone-header d-flex align-items-center">
          <div class="danger-icon me-3 bg-white bg-opacity-25 rounded-circle p-2">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <h5 class="mb-0 fw-bold">Zone de danger</h5>
        </div>
        <div class="card-body p-4">
          <div class="d-flex flex-column flex-md-row align-items-md-center gap-3">
            <div class="flex-grow-1">
              <h6 class="fw-bold mb-2">Supprimer mon compte</h6>
              <p class="text-muted mb-0">La suppression de votre compte est irréversible et entraînera la perte de toutes vos données.</p>
            </div>
            <div class="d-grid d-md-block">
              <button type="button" class="btn btn-lg btn-danger-outline" data-bs-toggle="modal" data-bs-target="#deleteAccountModal">
                <i class="fas fa-trash-alt me-2"></i>
                Supprimer mon compte
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de confirmation pour suppression de compte -->
<div class="modal fade custom-modal" id="deleteAccountModal" tabindex="-1" aria-labelledby="deleteAccountModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="deleteAccountModalLabel">
          <i class="fas fa-exclamation-triangle me-2"></i>
          Confirmation de suppression
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="text-center mb-4">
          <i class="fas fa-trash-alt text-danger" style="font-size: 4rem;"></i>
        </div>
        
        <p>Êtes-vous <strong>absolument sûr</strong> de vouloir supprimer votre compte ?</p>
        <p class="mb-0">Cette action est <strong>irréversible</strong> et entraînera la suppression de toutes vos données :</p>
        
        <ul class="mt-2">
          <li>Transactions</li>
          <li>Budgets</li>
          <li>Objectifs d'épargne</li>
          <li>Paramètres personnalisés</li>
        </ul>
        
        <form id="deleteAccountForm" action="/profile/delete" method="POST" class="mt-4">
          <div class="mb-3">
            <label for="confirmPassword" class="form-label">Pour confirmer, entrez votre mot de passe</label>
            <div class="input-icon-wrapper">
              <i class="fas fa-lock input-icon"></i>
              <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" required>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
          <i class="fas fa-times me-2"></i>
          Annuler
        </button>
        <button type="submit" form="deleteAccountForm" class="btn btn-danger">
          <i class="fas fa-trash-alt me-2"></i>
          Supprimer définitivement
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal d'édition de profil -->
<div class="modal fade modal-profile" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editProfileModalLabel">
          <i class="fas fa-user-edit me-2"></i>
          Modifier mon profil
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-4">
        <form action="/profile/update" method="POST" class="profile-form" id="editProfileForm">
          <div class="row g-4">
            <div class="col-md-6">
              <div class="mb-4">
                <label for="name" class="form-label">Nom</label>
                <div class="input-group input-group-lg shadow-sm">
                  <span class="input-group-text bg-white border-end-0">
                    <i class="fas fa-user text-primary"></i>
                  </span>
                  <input type="text" class="form-control border-start-0" id="name" name="name" value="<%= user.name %>" required minlength="2" maxlength="100" placeholder="Votre nom">
                </div>
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="mb-4">
                <label for="email" class="form-label">Email</label>
                <div class="input-group input-group-lg shadow-sm">
                  <span class="input-group-text bg-white border-end-0">
                    <i class="fas fa-envelope text-primary"></i>
                  </span>
                  <input type="email" class="form-control border-start-0" id="email" name="email" value="<%= user.email %>" required placeholder="exemple@email.com">
                </div>
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="mb-4">
                <label for="currency" class="form-label">Devise</label>
                <div class="input-group input-group-lg shadow-sm">
                  <span class="input-group-text bg-white border-end-0">
                    <i class="fas fa-money-bill-wave text-primary"></i>
                  </span>
                  <select class="form-select border-start-0" id="currency" name="currency" required>
                    <option value="EUR" <%= user.currency === 'EUR' ? 'selected' : '' %>>Euro (€)</option>
                    <option value="USD" <%= user.currency === 'USD' ? 'selected' : '' %>>Dollar US ($)</option>
                    <option value="GBP" <%= user.currency === 'GBP' ? 'selected' : '' %>>Livre Sterling (£)</option>
                    <option value="MAD" <%= user.currency === 'MAD' ? 'selected' : '' %>>Dirham Marocain (MAD)</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
          
          <div class="security-wrapper mt-4 mb-4 p-4 bg-light rounded-3 border-start border-primary border-4">
            <div class="d-flex align-items-center mb-3">
              <div class="security-icon d-flex align-items-center justify-content-center me-3">
                <i class="fas fa-shield-alt"></i>
              </div>
              <h5 class="mb-0">Sécurité du compte</h5>
            </div>
            
            <div class="row g-4">
              <div class="col-md-6">
                <div class="mb-4">
                  <label for="currentPassword" class="form-label">Mot de passe actuel</label>
                  <div class="input-group input-group-lg shadow-sm">
                    <span class="input-group-text bg-white border-end-0">
                      <i class="fas fa-key text-primary"></i>
                    </span>
                    <input type="password" class="form-control border-start-0" id="currentPassword" name="currentPassword" placeholder="••••••••">
                  </div>
                  <small class="text-muted mt-2 d-block">Laissez vide si vous ne souhaitez pas changer de mot de passe</small>
                </div>
              </div>
              
              <div class="col-md-6">
                <div class="mb-4">
                  <label for="newPassword" class="form-label">Nouveau mot de passe</label>
                  <div class="input-group input-group-lg shadow-sm">
                    <span class="input-group-text bg-white border-end-0">
                      <i class="fas fa-lock text-primary"></i>
                    </span>
                    <input type="password" class="form-control border-start-0" id="newPassword" name="newPassword" minlength="6" placeholder="••••••••">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
          <i class="fas fa-times me-2"></i>
          Annuler
        </button>
        <button type="submit" form="editProfileForm" class="btn btn-primary btn-profile-save">
          <i class="fas fa-save me-2"></i>
          Enregistrer les modifications
        </button>
      </div>
    </div>
  </div>
</div>

<%- include('../layouts/footer') %>